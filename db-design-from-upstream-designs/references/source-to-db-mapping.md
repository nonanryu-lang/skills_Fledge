# 入力資料→DB設計マッピング

## 目的
要件定義書・基本設計書・詳細設計書から、DB設計に必要な情報を漏れなく抽出する。

## 入力優先順位
1. 詳細設計書（最優先）
2. 基本設計書
3. 要件定義書

同一項目で矛盾がある場合は、優先順位の高い文書を採用し、差分は「設計判断ログ」に記録する。

## マッピング表

| 観点 | 要件定義書から抽出 | 基本設計書から抽出 | 詳細設計書から抽出 | DB設計への反映 |
|---|---|---|---|---|
| エンティティ候補 | 業務対象、管理対象データ | 画面項目、帳票項目、API項目 | DTO/リクエスト/レスポンス項目 | テーブル候補、主題ごとのスキーマ分割 |
| 属性候補 | 必須入力、検索条件、出力項目 | 画面項目定義、API I/O | バリデーション、型、桁、コード値 | カラム名、データ型、NULL可否、制約 |
| 識別子 | 一意要件、重複禁止条件 | 画面上のID、外部キー候補 | 取得・更新キー、UPSERT条件 | PK/UK、複合キー、サロゲートキー要否 |
| 関連 | 業務フロー上の依存 | 画面遷移/機能関連 | トランザクション内の更新順 | 1:1 / 1:N / N:M、中間テーブル |
| ライフサイクル | 作成・更新・削除ルール | 機能単位の状態遷移 | 処理分岐、論理削除ルール | ステータス列、履歴テーブル、削除フラグ |
| 性能 | 応答時間・件数要件 | 一覧画面の絞り込み | SQL実行頻度、バッチ条件 | インデックス、パーティション、集約テーブル |
| 監査/セキュリティ | 監査要件、保持期間 | 権限設計、参照範囲 | 更新者・更新契機 | 監査列、マスキング、保持/削除ポリシー |

## 抽出チェックリスト

- すべての主要機能に対して、作成・参照・更新・削除対象テーブルが特定できている
- すべての入力項目が、永続化対象か一時項目か分類されている
- コード値は正規化（マスタ化）かENUM相当か方針が決まっている
- 検索条件・ソート条件に対してインデックス方針がある
- 監査要件（誰が・いつ・何を）を満たす列設計がある

## 矛盾解消ルール

1. 文書間の差分を箇条書きで列挙する
2. 採用ルール（優先順位 or 設計判断）を明記する
3. 影響するテーブル/カラム/制約を列挙する
4. 未確定は `[TBD]` として質問事項化する
